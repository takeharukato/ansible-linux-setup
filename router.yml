#  -*- coding:utf-8 mode:yaml -*-
#  Ansible playbook
#  Copyright 2020 Takeharu KATO All Rights Reserved.
#
- hosts: router
  remote_user:  '{{ ansible_user }}'
  become: true
  roles:
    - role: selinux
      tags: selinux
    - role: repo-deb
      tags: repo-deb
      when: ansible_facts.os_family == "Debian"
    - role: repo-rpm
      tags: repo-rpm
      when: ansible_facts.os_family == "RedHat"
    - role: common
      tags: common
    - role: kea-dhcp
      tags: kea-dhcp
    - role: radvd
      tags: radvd
    - role: user-settings
      tags: user-settings
    - role: create-users
      tags: create-users
    - role: post-user-create
      tags: post-user-create
    - role: docker-ce
      tags: docker-ce

    # 留意事項
    # Docker起動時にDocker独自のFORWARDチェーンが作成されるため,
    # ルーティング/NAT設定の優先度確保のため,
    # docker-ceロールの後にrouter-configロールを実行する必要がある
    - role: router-config
      tags: router-config
    - role: sbom
      tags: sbom
      when:
        - sbom_enabled | default(false) | bool
# 最後に実行するようにすること
    - role: force-reboot
      tags: force-reboot
