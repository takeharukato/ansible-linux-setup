#  -*- coding:utf-8 mode:yaml -*-
#  Ansible playbook
#  Copyright 2020 Takeharu KATO All Rights Reserved.
#
#  ネットワーク設定変更後の graceful reboot 処理
#
---

# ネットワーク設定変更後に graceful reboot を実行し、
# iptables-persistent が保存された設定を復元させる
- name: Reboot host gracefully after network configuration changes
  reboot:
    reboot_timeout: 600
    msg: "Reboot triggered by router-config role to apply iptables-persistent rules"
    pre_reboot_delay: 2
  become: true

# SSH が利用可能になるのを待つ
- name: Wait for connection after reboot
  wait_for_connection:
    timeout: 300
