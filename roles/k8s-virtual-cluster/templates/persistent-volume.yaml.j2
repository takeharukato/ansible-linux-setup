#  -*- mode: yaml; coding: utf-8; line-endings: unix -*-
#  SPDX-License-Identifier: BSD-2-Clause
#
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}
#
#  Copyright (c) 2025 TAKEHARU KATO
#  This file is distributed under the two-clause BSD license.
#  For the full text of the license, see the LICENSE file in the project root directory.
#  このファイルは2条項BSDライセンスの下で配布されています。
#  ライセンス全文はプロジェクト直下の LICENSE を参照してください。

#
#  PersistentVolume 作成テンプレート (汎用)
#
#  host_vars で virtualcluster_persistent_volumes リストを定義することで、
#  任意のPVを作成できる。
#
apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ item.name | default('', true) | string | trim }}
  labels:
{% if item.labels is defined %}
{% for key, value in item.labels.items() %}
    {{ key }}: {{ value | string }}
{% endfor %}
{% else %}
    type: local
{% endif %}
spec:
  storageClassName: {{ item.storage_class | default('local-storage', true) | string | trim }}
  capacity:
    storage: {{ item.capacity | default('', true) | string | trim }}
  accessModes:
{% for mode in item.access_modes | default(['ReadWriteOnce'], true) %}
    - {{ mode }}
{% endfor %}
  persistentVolumeReclaimPolicy: {{ item.reclaim_policy | default('Delete', true) | string | trim }}
  local:
    path: {{ item.host_path | default('', true) | string | trim }}
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - {{ item.node_name | default('', true) | string | trim }}
