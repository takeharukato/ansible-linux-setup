#
#  -*- coding:utf-8 mode:yaml -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

#
# Cilium設定値
#
operator:
  image:
    # Ciliumオペレータのコンテナイメージの版数
    tag: {{k8s_cilium_image_version}}
    useDigest: false
    suffix: ""
    imageSuffix: ""

image:
  # Cilium CNIのコンテナイメージの版数
  tag: {{k8s_cilium_image_version}}
  useDigest: false
  suffix: ""
  imageSuffix: ""
  useDigest: false

hubble:
  relay:
    enabled: true
  ui:
    enabled: false

cni:
  exclusive: false

ipam:
  mode: kubernetes

k8sServiceHost: {{k8s_ctrlplane_endpoint}}
k8sServicePort: 6443

kubeProxyReplacement: true

bpf:
  masquerade: true

ipMasqAgent:
  enabled: false

routingMode: native
autoDirectNodeRoutes: true
tunnel: "disabled"
ipv4NativeRoutingCIDR: {{k8s_pod_ipv4_network_cidr}}
ipv6NativeRoutingCIDR: {{k8s_pod_ipv6_network_cidr}}

ipv4:
  enabled: true

ipv6:
  enabled: true

enable-ipv4-masquerade: false
enable-ipv6-masquerade: false

{% set have_cluster = (k8s_cilium_cm_cluster_name | default('', true) | length)
                       and (k8s_cilium_cm_cluster_id is defined)
                       and (1 <= (k8s_cilium_cm_cluster_id | int) <= 255) %}

{% if have_cluster %}
cluster:
  name: {{ k8s_cilium_cm_cluster_name }}
  id: {{ k8s_cilium_cm_cluster_id }}

clustermesh:
  # apiserver経由でのクラスタメッシュ接続を有効化
  # Cilium の clustermesh-apiserver をデプロイして,
  # クラスタ間コントロールプレーン（クラスタ情報・ID・サービス情報の同期など）を
  # 提供する機能を利用する場合は true に設定
  # helmチャートの既定値は false
  # https://docs.cilium.io/en/stable/clustermesh/#clustermesh-apiserver
  useAPIServer: true
  apiserver:
    service:
      # サービスの公開方法: NodePort (既定) / LoadBalancer / ClusterIP から選択
      type: NodePort

# Cilium Endpoint Slice機能を有効化
# Cilium Operator が多数の Cilium Endpoint（CEP） をバッチ化して,
# Cilium Endpoint Slice (CES) に集約し, Cilium Agent は CES を購読するモードに
# 切替える機能
# kube-apiserver への更新数を削減し、スケーラビリティを向上させる機能
# (現時点ではベータ版なのでfalseに設定)
# helmチャートの既定値は false
ciliumEndpointSlice:
  enabled: false

{% endif %}