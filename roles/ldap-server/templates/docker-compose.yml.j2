#
#  -*- coding:utf-8 mode:yaml -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

#
# OpenLDAP/PHP LDAP Admin用のDocker compose
#
version: '3'

services:
  ldap-server:
    image: osixia/openldap:latest
    restart: always
    container_name: ldap-server
    environment:
      LDAP_ORGANISATION: "{{ldap_organization}}"
      LDAP_DOMAIN: "{{ ldap_domain }}"
      LDAP_ADMIN_PASSWORD: "{{ ldap_admin_password }}"
    volumes:
      - "data:/var/lib/ldap"
      - "config:/etc/ldap/slapd.d"
    ports:
      - "389:389"
    networks:
      - ldapnet

  ldap-admin:
    image: osixia/phpldapadmin:latest
    restart: always
    container_name: ldap-admin
    environment:
      PHPLDAPADMIN_LDAP_HOSTS: "ldap-server"
      PHPLDAPADMIN_HTTPS: "true"
    ports:
      - "{{ ldap_admin_port }}:443"
    networks:
      - ldapnet
    volumes:
      - "phpadmin_data:/var/www/phpldapadmin"

networks:
  ldapnet:

volumes:
  data:
  config:
  phpadmin_data: