#!/bin/sh
#  -*- coding:utf-8 mode:bash -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}
#
# busyboxのコンテナイメージを使用して, ホスト上のカレントディレクトリにあるtarファイルの
# 内容をopenldapコンテナ内で定義されているボリュームに展開する
#

# 1) openldapのコンテナIDを取得する
container_id=`docker ps|grep osixia/openldap:|awk -F ' ' '{print $1;}'`

# 2) phpldapadminのコンテナIDを取得する
phpadmin_container_id=`docker ps|grep osixia/phpldapadmin:|awk -F ' ' '{print $1;}'`

# 3) ホストのカレントディレクトリをコンテナ内の/backupディレクトリにマウントした上で,
# openldapコンテナのボリュームを参照可能にして, busyboxのコンテナを生成し,
# カレントディレクトリにあるconfig-backup.tarの内容をopenldapのコンテナ内に展開する
docker run --rm --volumes-from "${container_id}" -v `pwd`:/backup busybox tar xvf /backup/config-backup.tar -C /

# 4) ホストのカレントディレクトリをコンテナ内の/backupディレクトリにマウントした上で,
# openldapコンテナのボリュームを参照可能にして, busyboxのコンテナを生成し,
# カレントディレクトリにあるdata-backup.tarの内容をopenldapのコンテナ内に展開する
docker run --rm --volumes-from "${container_id}" -v `pwd`:/backup busybox tar xvf /backup/data-backup.tar -C /

# 4) ホストのカレントディレクトリをコンテナ内の/backupディレクトリにマウントした上で,
# phpldapadminコンテナのボリュームを参照可能にして, busyboxのコンテナを生成し,
# カレントディレクトリにあるphpadmin-backup.tarの内容をopenldapのコンテナ内に展開する
docker run --rm --volumes-from "${phpadmin_container_id}" -v `pwd`:/backup busybox tar xvf /backup/phpadmin-backup.tar -C /
