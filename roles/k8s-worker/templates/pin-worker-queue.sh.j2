#!/bin/bash
#  -*- coding:utf-8 mode:bash -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

#
# unbounded なワーカーキューを片寄せする
#
SYSTEM_CPUS="{{k8s_reserved_system_cpus_default}}"
WQ_UNBOUND_PATH="/sys/devices/virtual/workqueue"


do_bind_worker_queue(){
    local bind_param=`echo "${SYSTEM_CPUS}"|sed -e 's/\s*//g'|sed -e 's|"||g'|sed -e "s|\'||g"`

    echo "${bind_param}" | sudo tee "${WQ_UNBOUND_PATH}/wq_unbound_cpumask" 2>/dev/null
    for f in `echo "${WQ_UNBOUND_PATH}/*/cpumask"`; do
        echo "Set ${f} cpumask to {bind_param}"
        echo "${bind_param}" | sudo tee "$f" >/dev/null
    done 2>/dev/null
}

main(){

    do_bind_worker_queue
}

main $@
exit 0
