#!/bin/bash
# -*- coding:utf-8 mode:bash -*-
#
# emacsのパッケージをインストールする
# install-emacs-packages.sh パッケージ名
#
# 実行例: install-emacs-packages.sh dockerfile-mode
# 参考:
# https://gist.github.com/knishioka/4578f62e82f90f958fb30da4db557078
#
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

template=`mktemp`.sh
script=`mktemp`.sh
cat <<EOF > "${template}"
    emacs --batch \
	  --eval "(require 'package)" \
	  --eval "(add-to-list 'package-archives '(\"gnu\" . \"http://elpa.gnu.org/packages/\") t)" \
	  --eval "(add-to-list 'package-archives '(\"melpa\" . \"https://melpa.org/packages/\") t)" \
	  --eval "(add-to-list 'package-archives '(\"org\" . \"http://orgmode.org/elpa/\") t)" \
	  --eval "(package-refresh-contents)" \
	  --eval "(package-initialize)" \
	  --eval "(package-install '__package_name__)"
EOF

while [ $# -gt 0 ];
do
    pkg=$1
    shift
    cat "${template}"|sed -e "s|__package_name__|${pkg}|g" > "${script}"
    /bin/bash "${script}"
    rm -f "${script}"
done
rm -f "${template}"
