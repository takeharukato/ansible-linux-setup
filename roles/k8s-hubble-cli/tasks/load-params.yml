#  -*- coding:utf-8 mode:yaml -*-
#  Ansible playbook
#  Copyright 2020 Takeharu KATO All Rights Reserved.
#
#  設定関連タスク
#
---

# Ubuntu用パッケージ名読み込み
- name: Include ubuntu package names
  ansible.builtin.include_vars: "{{ playbook_dir }}/vars/packages-ubuntu.yml"
  when: ansible_facts.os_family == 'Debian'

# RHEL用パッケージ名読み込み
- name: Include RHEL package names
  ansible.builtin.include_vars: "{{ playbook_dir }}/vars/packages-rhel.yml"
  when: ansible_facts.os_family == 'RedHat'

# ディストリビューション差異吸収用パラメータ読み込み
- name: Include cross-distro.yml
  ansible.builtin.include_vars: "{{ playbook_dir }}/vars/cross-distro.yml"

# 共通設定読み込み
- name: Include config vars
  ansible.builtin.include_vars: "{{ playbook_dir }}/vars/all-config.yml"

# Kubernetes API広告アドレス設定読み込み
- name: Include K8s API address vars
  ansible.builtin.include_vars: "{{ playbook_dir }}/vars/k8s-api-address.yml"

- name: Normalize hubble_cli_version
  ansible.builtin.set_fact:
    hubble_cli_version: "{{ hubble_cli_version | string | trim }}"
  changed_when: false

- name: Assert hubble_cli_version is defined
  ansible.builtin.assert:
    that:
      - hubble_cli_version is defined
      - (hubble_cli_version | length) > 0
    fail_msg: 'Set "hubble_cli_version" in inventory or extra vars before running k8s-hubble-cli role.'
  changed_when: false
