#!/usr/bin/env bash
#  -*- coding:utf-8 mode:bash -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

#
# アプリケーションコアでのノイズ採取
#

get_noise(){
    local cwd=`pwd`
    local time_stamp="$(date +%Y%m%d-%H%M%S)"

    RUN_DIR="${cwd}/runs/${time_stamp}"
    export RUN_DIR
    mkdir -p "${RUN_DIR}"
    echo "${RUN_DIR}"
    {{ netgauge_dir }}/bin/00_detect_cpus.sh
    sudo {{ netgauge_dir }}/bin/10_prepare_cgroup.sh
    {{ netgauge_dir }}/bin/20_launch_netgauge.sh
    {{ netgauge_dir }}/bin/25_flatten_values.sh "${RUN_DIR}"
    {{ netgauge_dir }}/bin/30_plot_all.sh "${RUN_DIR}"
}

main(){

    get_noise
}

main $@
