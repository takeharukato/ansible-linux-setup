#
#  -*- coding:utf-8 mode:dockerfile -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

# http://docs.docker.com/reference/builder
# docker backup image (boombatower/docker-backup).
#  元のコードは以下
# boombatower/opensuse イメージは古いので,
# 公式の opensuse/leap:15.6 イメージをベースにして作成しなおした。
# ------------------------------------------------------------
# FROM boombatower/opensuse
# MAINTAINER Jimmy Berry <jimmy@boombatower.com>
#
# RUN zypper refresh && \
#    zypper -n in --no-recommends tar xz
#
# ADD backup.sh /root/bin/
#
# VOLUME /backup
# ENTRYPOINT ["/root/bin/backup.sh"]
# CMD ["backup"]
# ------------------------------------------------------------

# 公式ベース ( 必要に応じて 15.6 / Tumbleweed に変更 )
FROM opensuse/leap:15.6

# Maintainer は LABEL で指定する
LABEL maintainer="Jimmy Berry <jimmy@boombatower.com>"

# zypper を非対話, 鍵自動取り込みで実行し, 最後に cleanする
RUN zypper --non-interactive --gpg-auto-import-keys refresh && \
    zypper --non-interactive install --no-recommends tar xz && \
    zypper clean -a

# /root/bin を作ってから配置
# 先に同じディレクトリに backup.sh を置いてビルドすること
COPY backup.sh /tmp/backup.sh
RUN install -Dm0755 /tmp/backup.sh /root/bin/backup.sh && rm -f /tmp/backup.sh

#/backup をボリュームのマウントポイントに指定
VOLUME ["/backup"]
# /root/bin/backup.shを実行
ENTRYPOINT ["/root/bin/backup.sh"]
# エントリポイント(/root/bin/backup.sh)の引数 に "backup" を指定
CMD ["backup"]