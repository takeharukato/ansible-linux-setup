#
#  -*- coding:utf-8 mode:yaml -*-
# This file is generated by ansible.
{# 日付の取得 #}
# last update: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime(ansible_date_time.epoch) }}

#
# Redmine用docker-compose.yml
#

services:
  {{redmine_service}}:
    image: {{redmine_image}}
    ports:
      - {{redmine_service_port}}:3000
    environment:
      REDMINE_DB_POSTGRES: {{redmine_db_service}}
      REDMINE_DB_DATABASE: {{redmine_db_name}}
      REDMINE_DB_USERNAME: {{redmine_db_user}}
      REDMINE_DB_PASSWORD: {{redmine_db_password}}
      REDMINE_SECRET_KEY_BASE: supersecretkey
      REDMINE_DB_PORT: 5432
    volumes:
      - vol_redmine:/usr/src/redmine/files
    restart: always

  {{redmine_db_service}}:
    image: {{redmine_db_image}}
    ports:
      - 5432:5432
    environment:
      POSTGRES_DB: {{redmine_db_name}}
      POSTGRES_USER: {{redmine_db_user}}
      POSTGRES_PASSWORD: {{redmine_db_password}}
    volumes:
      - vol_redmine_db:/var/lib/postgresql/data
    restart: always

volumes:
  vol_redmine:
    external: true
    name: {{redmine_files_volume}}
  vol_redmine_db:
    external: true
    name: {{redmine_database_volume}}
